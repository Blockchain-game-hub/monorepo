import React, { useState, useEffect } from "react";
import type { NextPage } from "next";
import Head from "next/head";
import styles from "../styles/Home.module.css";
import { Button, Flex, Grid, Container } from "@chakra-ui/react";
import Navbar from "../components/Navbar";
import ContentCard from "../components/ContentCard";
import PortalText, { textConfig } from "../components/PortalText";
import { useWalletContext } from "../context/wallet";
import { useRouter } from "next/router";
import Link from "next/link";
const Home: NextPage = () => {
  const walletContext = useWalletContext();
  const { auth, address, connect, disconnect } = walletContext;
  const [posts, setPosts] = useState([]);
  const router = useRouter();

  useEffect(() => {
    if (!address) {
      return;
    }
    async function fetchPostData() {
      try {
        const response = await fetch("/api/post", {
          method: "GET",
          headers: {
            Authorization: `${auth?.token}`,
            "Content-Type": "application/json",
          },
        });
        const result = await response.json();
        setPosts(result);
        console.log(posts);
      } catch (err) {
        console.log("err", err);
      }
    }

    fetchPostData();
  }, [address]);

  return (
    <div style={{ background: "black" }}>
      <Navbar />
      <div className={styles.container}>
        <Head>
          <title>Portals - Create a portal into your world</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>

        <main className={styles.main}>
          <Flex
            width="100%"
            backgroundImage="/images/ASU.gif"
            flexDirection="column"
            backgroundPosition="center"
            backgroundSize="35%"
            backgroundRepeat="no-repeat"
            pt="10em"
            pb="10em"
          >
            <PortalText
              config={textConfig.h2}
              style={{ textAlign: "center", lineHeight: "1.2" }}
            >
              Create a portal into your world
            </PortalText>
            <Container maxW="container.md" paddingTop="20px" centerContent>
              <PortalText
                config={textConfig.p2}
                style={{ textAlign: "center" }}
              >
                Portals is programmable money meets programmable media.
              </PortalText>
              <Button
                onClick={address ? () => router.push("/manage") : connect}
                color="black"
                bg="white"
                borderRadius="5"
                marginTop="26px"
              >
                Create a Portal
              </Button>
            </Container>
          </Flex>
          <Grid
            templateColumns={[
              "repeat(1, 1fr)",
              "repeat(1, 1fr)",
              "repeat(2, 1fr)",
              "repeat(3, 1fr)",
              "repeat(4, 1fr)",
            ]}
            gap={5}
            paddingTop="60px"
          >
            {posts.map((post) => {
              return (
                <ContentCard key={post.id} content={post} showDate={true} />
              );
            })}
          </Grid>
        </main>
      </div>

      <footer>
        <Flex bg="#333333" flexDirection="column" alignItems="center" p="5">
          <Flex mb="2" justifyContent="center" width="100%" height="3vh">
            <Flex mr="5">
              <Link
                href="https://showcase.ethglobal.com/web3jam/portals"
                passHref={true}
              >
                <a target="_blank">
                  <PortalText cursor="pointer" weight="400">
                    About
                  </PortalText>
                </a>
              </Link>
            </Flex>
            <Flex>
              <Link href="https://discord.gg/dgFQUny5RZ" passHref={true}>
                <a target="_blank">
                  <PortalText weight="400">Discord</PortalText>
                </a>
              </Link>
            </Flex>
          </Flex>
          <PortalText weight="400">Â© 2021 Portals DAO</PortalText>
        </Flex>
      </footer>
    </div>
  );
};

export default Home;
